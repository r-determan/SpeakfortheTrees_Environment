---
title: "Processing"
author: "Rose Determan"
date: "11/7/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load(sf, stars,raster,rgdal,tmap, magrittr)

getwd()
```

# Import Census Tracts
```{r}
#https://data.boston.gov/dataset/7156ac97-670d-4b9f-8070-6a1264e5fb91/resource/1721fbb7-ee56-4a61-9e1b-2f2342d202d1/download/census2020_tracts.zip
tracts <- st_read("Census2020_Tracts/Census2020_tracts.shp")
```

# Import Landsat Temperature Raster
```{r}
#https://doi.org/10.5066/P960F8OC
#https://doi.org/10.5066/P960F8OC

fp1 <- "Surface_Temp/LC08_CU_030005_20210812_20210822_02_ST/LC08_CU_030005_20210812_20210822_02_ST_B10.TIF"
temp1=raster(fp1)

fp2 <- "Surface_Temp/LC08_CU_030006_20210812_20210822_02_ST/LC08_CU_030006_20210812_20210822_02_ST_B10.TIF"
temp2=raster(fp2)

#merge the two rasters 
x <- list(temp1, temp2)
names(x) <- c("x", "y")
x$filename <- 'test.tif'
x$overwrite <- TRUE
merge_temp <- do.call(merge, x)

#plot to double check the merge
#plot(m)
```

<<<<<<< HEAD
# Use extract function 
Do the equivalent of QGIS's zonal stats. Calculate the mean of each census tract. Join the dataframe with mean temperatures to the census tracts shapefile. 
=======
Use extract function to do the equivalent of QGIS's zonal stats. Calculate the mean of each census tract. Join the dataframe with mean temperatures to the census tracts shapefile. 
>>>>>>> 38aebbc701612844b0b85c13d7ca9ca262c4ff72
https://www.neonscience.org/resources/learning-hub/tutorials/dc-crop-extract-raster-data-r
```{r}
temp_ex <- raster::extract(x=merge_temp, y=tracts, fun=mean, df=TRUE)
temp_ex <- rename(temp_ex,OBJECTID = ID,  mean_temp =test)
tracts_jn <- left_join(tracts, temp_ex)
```
<<<<<<< HEAD
# Plot the mean temp for each census tract
=======
Plot the mean temp for each census tract
>>>>>>> 38aebbc701612844b0b85c13d7ca9ca262c4ff72
```{r}
tmap_mode("view")

 tm_shape(tracts_jn)+
    tm_polygons("mean_temp") + 
    tm_borders(col="#000000", lwd=0.2)
```

